/*
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

rule malware_gallium
{
  meta:
    author = "Google Cloud Security"
    description = "GALLIUM malware"
    reference = "https://www.microsoft.com/security/blog/2019/12/12/gallium-targeting-global-telecom/"
    yara_version = "YL2.0"
    rule_version = "1.0"

  events:
    (
      $e1.metadata.event_type = "NETWORK_DNS" and
      (
        $e1.network.dns.questions.name = "asyspy256.ddns.net" or
        $e1.network.dns.questions.name = "hotkillmail9sddcc.ddns.net" or
        $e1.network.dns.questions.name = "rosaf112.ddns.net" or
        $e1.network.dns.questions.name = "cvdfhjh1231.myftp.biz" or
        $e1.network.dns.questions.name = "sz2016rose.ddns.net" or
        $e1.network.dns.questions.name = "dffwescwer4325.myftp.biz" or
        $e1.network.dns.questions.name = "cvdfhjh1231.ddns.net"
      )
    )
    or
    (
      $e1.target.file.sha256 = "9ae7c4a4e1cfe9b505c3a47e66551eb1357affee65bfefb0109d02f4e97c06dd" or
      $e1.target.file.sha256 = "7772d624e1aed327abcd24ce2068063da0e31bb1d5d3bf2841fc977e198c6c5b" or
      $e1.target.file.sha256 = "657fc7e6447e0065d488a7db2caab13071e44741875044f9024ca843fe4e86b5" or
      $e1.target.file.sha256 = "2ef157a97e28574356e1d871abf75deca7d7a1ea662f38b577a06dd039dbae29" or
      $e1.target.file.sha256 = "52fd7b90d7144ac448af4008be639d4d45c252e51823f4311011af3207a5fc77" or
      $e1.target.file.sha256 = "a370e47cb97b35f1ae6590d14ada7561d22b4a73be0cb6df7e851d85054b1ac3" or
      $e1.target.file.sha256 = "5bf80b871278a29f356bd42af1e35428aead20cd90b0c7642247afcaaa95b022" or
      $e1.target.file.sha256 = "6f690ccfd54c2b02f0c3cb89c938162c10cbeee693286e809579c540b07ed883" or
      $e1.target.file.sha256 = "3c884f776fbd16597c072afd81029e8764dd57ee79d798829ca111f5e170bd8e" or
      $e1.target.file.sha256 = "1922a419f57afb351b58330ed456143cc8de8b3ebcbd236d26a219b03b3464d7" or
      $e1.target.file.sha256 = "fe0e4ef832b62d49b43433e10c47dc51072959af93963c790892efc20ec422f1" or
      $e1.target.file.sha256 = "7ce9e1c5562c8a5c93878629a47fe6071a35d604ed57a8f918f3eadf82c11a9c" or
      $e1.target.file.sha256 = "178d5ee8c04401d332af331087a80fb4e5e2937edfba7266f9be34a5029b6945" or
      $e1.target.file.sha256 = "51f70956fa8c487784fd21ab795f6ba2199b5c2d346acdeef1de0318a4c729d9" or
      $e1.target.file.sha256 = "889bca95f1a69e94aaade1e959ed0d3620531dc0fc563be9a8decf41899b4d79" or
      $e1.target.file.sha256 = "332ddaa00e2eb862742cb8d7e24ce52a5d38ffb22f6c8bd51162bd35e84d7ddf" or
      $e1.target.file.sha256 = "44bcf82fa536318622798504e8369e9dcdb32686b95fcb44579f0b4efa79df08" or
      $e1.target.file.sha256 = "63552772fdd8c947712a2cff00dfe25c7a34133716784b6d486227384f8cf3ef" or
      $e1.target.file.sha256 = "056744a3c371b5938d63c396fe094afce8fb153796a65afa5103e1bffd7ca070"
    )

  condition:
    $e1
}
