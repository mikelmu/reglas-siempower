rule malware_user_agent {
 meta:
    author = "Florian Roth"
    description = "Detects suspicious user agent strings used by malware in proxy logs  License: https://github.com/Neo23x0/sigma/blob/master/LICENSE.Detection.Rules.md."
    reference = "https://tdm.socprime.com/tdm/info/45fvtqritd2c"
    version = "0.01"
    created = "2021-03-09"
    category = "proxy"

  events:
($selection.principal.application = "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:53.0) Gecko/20100101 Chrome /53.0" or $selection.principal.application = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1)" or $selection.principal.application = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0)" or $selection.principal.application = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NET CLR  1.1.4322)" or $selection.principal.application = "HttpBrowser/1.0" or re.regex($selection.principal.application, `.*<|>.*`) or $selection.principal.application = "nsis_inetc (mozilla)" or $selection.principal.application = "Wget/1.9+cvs-stable (Red Hat modified)" or $selection.principal.application = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; .NET CLR 1.1.4322)" or re.regex($selection.principal.application, `.*zeroup.*`) or re.regex($selection.principal.application, `Mozilla/5\.0 \(Windows NT 5\.1 ; v\..*`) or re.regex($selection.principal.application, `.* adlib/.*`) or re.regex($selection.principal.application, `.* tiny`) or re.regex($selection.principal.application, `.* BGroom .*`) or re.regex($selection.principal.application, `.* changhuatong`) or re.regex($selection.principal.application, `.* CholTBAgent`) or $selection.principal.application = "Mozilla/5.0 WinInet" or $selection.principal.application = "RookIE/1.0" or $selection.principal.application = "M" or $selection.principal.application = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)" or $selection.principal.application = "Mozilla/4.0 (compatible;MSIE 7.0;Windows NT 6.0)" or $selection.principal.application = "backdoorbot" or $selection.principal.application = "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30731)" or $selection.principal.application = "Opera/8.81 (Windows NT 6.0; U; en)" or $selection.principal.application = "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30729)" or $selection.principal.application = "Opera" or $selection.principal.application = "Mozilla/4.0 (compatible; MSIE 5.0; Windows 98)" or $selection.principal.application = "Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)" or $selection.principal.application = "MSIE" or re.regex($selection.principal.application, `.*\(Charon; Inferno\)`) or $selection.principal.application = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/5.0)" or $selection.principal.application = "Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)" or $selection.principal.application = "Mozilla/4.0(compatible; MSIE 6.0; Windows NT 5.1)" or re.regex($selection.principal.application, `.* pxyscand.*`) or re.regex($selection.principal.application, `.* asd`) or re.regex($selection.principal.application, `.* mdms`) or $selection.principal.application = "sample" or $selection.principal.application = "nocase" or $selection.principal.application = "Moxilla" or re.regex($selection.principal.application, `Win32 .*`) or re.regex($selection.principal.application, `.*Microsoft Internet Explorer.*`) or re.regex($selection.principal.application, `agent .*`) or $selection.principal.application = "AutoIt" or $selection.principal.application = "IczelionDownLoad")

  condition:
    $selection
}
